<loading-overlay [loading]="loading">
  <div class="pb-container row no-gutters" *ngIf="cacheCompleted">
    <div class="pb-sidebar mat-elevation-z4">
      <div class="actions">

        <button color="accent" class="add-button w-100" mat-flat-button [matMenuTriggerFor]="addMenu">
          <mat-icon>add</mat-icon>
          <span>{{ 'New' | translate }}</span>
        </button>
        <mat-menu #addMenu="matMenu" class="width-200" xPosition="after">
          <button mat-menu-item (click)="fileInput.click()">
            <mat-icon>attach_file</mat-icon>{{ 'Submission' | translate }}
          </button>
          <button mat-menu-item (click)="createSubmissionFromClipboard()" [disabled]="!clipboardIsEligible()">
            <mat-icon>insert_photo</mat-icon>{{ 'From Clipboard' | translate }}
          </button>
          <button mat-menu-item (click)="createNewJournal()">
            <mat-icon>message</mat-icon>{{ 'Journal/Status' | translate }}
          </button>
        </mat-menu>
        <input #fileInput type="file" class="d-none" (change)="filesSelected($event)" multiple>

        <mat-form-field class="w-100 search-input" color="accent" appearance="fill">
          <input matInput [formControl]="searchControl">
          <mat-icon style="vertical-align: bottom; font-size: 1.2em" matPrefix>search</mat-icon>
        </mat-form-field>

        <div class="submission-actions" *ngIf="submissions.length">
          <button mat-flat-button color="warn" (click)="deleteMany()">
            <mat-icon>delete</mat-icon>
          </button>
          <button mat-flat-button color="primary" [disabled]="!hasPostableSubmissions()" (click)="postMany()">
            <mat-icon>send</mat-icon>
          </button>
        </div>
      </div>

      <div class="submission-nav">
        <table class="table table-dark m-0" style="height: 100%">
          <cdk-virtual-scroll-viewport itemSize="95">
            <tr *cdkVirtualFor="let record of submissions; templateCacheSize: 0">
              <td>
                <submission-record-view [submission]="record"></submission-record-view>
              </td>
            </tr>
          </cdk-virtual-scroll-viewport>
        </table>

        <!-- Queue List -->
        <table class="table table-dark m-0" style="height: 100%">
          <thead>
            <tr>
              {{ 'Queue' | translate }}
              <i class="fas fa-ban warn-text cancel-all-btn" *ngIf="queuedSubmissions.length" (click)="cancelAllQueued()"></i>
            </tr>
          </thead>
          <cdk-virtual-scroll-viewport itemSize="80" *ngIf="queuedSubmissions.length">
            <tr *cdkVirtualFor="let record of queuedSubmissions; templateCacheSize: 0">
              <td>
                <submission-posting-view [submission]="record"></submission-posting-view>
              </td>
            </tr>
          </cdk-virtual-scroll-viewport>
          <tbody *ngIf="!queuedSubmissions.length" style="font-size: 12px;">
            <td class="text-center">{{ 'Empty' | translate }}</td>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col col-sm col-md col-lg col-xl pb-content-grid">
      <div class="nav-bar">
        <nav mat-tab-nav-bar backgroundColor="accent">
          <a mat-tab-link routerLink="logs" routerLinkActive #rla3="routerLinkActive" [active]="rla3.isActive" [matTooltip]="'Logs' | translate">
            <mat-icon>history</mat-icon>
            <span>{{ 'Logs' | translate }}</span>
          </a>

          <a mat-tab-link routerLink="bulk" routerLinkActive #rla="routerLinkActive" [active]="rla.isActive" [matTooltip]="'Bulk' | translate">
            <mat-icon>view_list</mat-icon>
            <span>{{ 'Bulk' | translate }}</span>
          </a>

          <a mat-tab-link routerLink="template" routerLinkActive #rla2="routerLinkActive" [active]="rla2.isActive" [matTooltip]="'Template' | translate">
            <mat-icon>folder</mat-icon>
            <span>{{ 'Template' | translate }}</span>
          </a>
        </nav>

        <nav mat-tab-nav-bar backgroundColor="accent">
          <a class="submission-tab" *ngFor="let tab of _tabManager.tabChanges | async" mat-tab-link [routerLink]="tab.type + '/' + tab.id" routerLinkActive #rla="routerLinkActive" [active]="rla.isActive">
            <submission-tab [tab]="tab"></submission-tab>
          </a>
        </nav>
      </div>

      <div style="overflow: auto">
        <div class="container mat-elevation-z4" *ngIf="!hideRoute">
          <router-outlet></router-outlet>
        </div>
      </div>
    </div>
  </div>
</loading-overlay>
